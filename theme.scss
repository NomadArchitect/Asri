@use 'style/base' as *;
@use 'style/main';

html[data-theme-mode="light"]:root {
    color-scheme: light;
    // https://stackoverflow.com/questions/21157231/mac-os-x-scrollbar-is-sometimes-white-transparent-and-sometimes-black-transpare

    @include theme-root($theme-light);

    body {
        ::selection {
            background-color: var(--b3-theme-primary-lightest);
        }
    }
}

html[data-theme-mode="dark"]:root {
    color-scheme: dark;
    @include theme-root($theme-dark);
}

:root {
    @include font-family;
    @include cssvars;
}

body {
    -webkit-font-smoothing: auto;

    @include darkmode-counterpart {
        -webkit-font-smoothing: antialiased;
    }

    text-underline-position: under;
}


body:not(.body--mobile) {
    // --toolbar-height: 42px;
    --topbar-z-index: 2;
    --avoid-topbar: calc(var(--toolbar-height));

    .toolbar {
        margin-bottom: calc(var(--toolbar-height) * -1);
        z-index: var(--topbar-z-index);
        pointer-events: none;
        app-region: drag;

        #drag {
            opacity: 0;
            // background-color: aqua;
        }
    }

    #toolbar {
        // --topbar-left-spacing: 20px;
        // --topbar-right-spacing: 0px;
        background-color: transparent;
        border-bottom-color: transparent;

        .toolbar__item {
            pointer-events: visibleFill;
            app-region: no-drag;
            height: auto;
        }

        #AsriPluginIconsContainer {
            width: auto;
            // height: 28px;
            height: 1px;
            border-radius: 6px;
            align-self: center;
            // outline: 1.5px solid var(--outline-clr);
            // outline-offset: 0px;
            position: absolute;
            // top: 10px;
            top: var(--toolbar-height);
            background-color: var(--container-bg);
            // background-color: var(--b3-theme-surface);
            background-color: var(--b3-border-color-trans);
            // transition: 0.2s 0.1s;
            z-index: -1;
        }

        #AsriTopbarLeftSpacing {
            width: var(--topbar-left-spacing);
            // transition: 0.2s;
        }

        #AsriTopbarRightSpacing {
            width: var(--topbar-right-spacing);
            // transition: 0.2s;
        }
    }

    // 页签栏
    .layout__center .layout-tab-bar {
        margin: 10px;

        &:not(&--readonly) {
            margin-right: 4px;
        }

        &--readonly {
            margin-left: 0;
            margin-right: 8px;

            .item--readonly {
                justify-content: end;

                .fn__flex-1:nth-child(2) {
                    flex-grow: 0;
                }

                .block__icon:hover {
                    background-color: transparent;
                }
            }
        }
    }

    .b3-dialog--open .layout-tab-bar {
        margin: 8px auto;
    }

    .layout__center {
        .protyle-breadcrumb {
            .fn__space {
                width: 0;
            }

            .block__icon {
                margin: 1.5px;
            }
        }
    }

    // 侧栏、侧栏面板 ——————————————————————————
    #dockLeft {
        padding-top: calc(var(--avoid-topbar) - 6px);
    }

    #dockRight {
        background-color: var(--b3-theme-background);
    }

    .layout__dockl,
    .layout__dockr {

        >.fn__flex:not(.fn__none):first-child,
        >.fn__flex.fn__none~.fn__flex {
            .layout-tab-container {
                padding-top: var(--avoid-topbar);
            }
        }

        &.layout--float {
            // height: calc(100% - var(--toolbar-height));
            height: 100%;
        }
    }

    .layout__dockl{
        >.fn__flex:not(.fn__none):first-child,
        >.fn__flex.fn__none~.fn__flex {
            .layout-tab-container {
                padding-top: calc(var(--avoid-topbar) - 6px);
            }
        }
    }

    .layout__dockr {

        >.fn__flex:not(.fn__none):first-child,
        >.fn__flex.fn__none~.fn__flex {
            .layout-tab-container {
                padding-top: var(--avoid-topbar);
            }
        }

        &:not(.layout--float) {
            .layout-tab-container {
                background-color: var(--b3-theme-background);
                border-left: 1px solid var(--b3-border-color);
            }
        }
    }

    &.body--mac {
        #dockRight {
            padding-top: var(--avoid-topbar);
        }

        .layout__dockr.layout--float {

            >.fn__flex:not(.fn__none):first-child,
            >.fn__flex.fn__none~.fn__flex {
                .layout-tab-container {
                    padding-top: 4px;
                }
            }
        }
    }

    &.body--win32,
    &.body--browser {
        .layout--float {

            >.fn__flex:not(.fn__none):first-child,
            >.fn__flex.fn__none~.fn__flex {
                .layout-tab-container {
                    padding-top: 4px;
                }
            }
        }
    }

    // 禁用拖动的区域 ————————————————————————————————————
    // 页签栏
    .layout-tab-bar--readonly .block__icon,
    .layout-tab-bar:not(.layout-tab-bar--readonly),

    //菜单
    .b3-menu,
    .b3-menu__submenu,
    .protyle-hint,

    //对话窗口、浮动窗口
    .block__popover,
    .b3-dialog__body,

    //其他
    .block__icons>.block__icon,

    .block__icons>.search__label,

    .search__header,

    .layout--float,

    .protyle-breadcrumb .block__icon,

    .protyle-breadcrumb__item,

    .protyle-breadcrumb button,

    .b3-snackbar,

    .protyle-toolbar,

    .protyle-util,

    .dock__item {
        app-region: no-drag;
    }
}